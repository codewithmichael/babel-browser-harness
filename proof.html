<!--
BBH ♥ Babel Browser Harness
In-browser CDN-based ES6+ transpiling via Babel
Copyright (c) 2016, Michael Spencer
MIT License

PROOF OF CONCEPT:
Scripts can be stored externally and loaded via IFrame without a web server.
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Babel Browser Harness</title>
    <script src="./bbh.js"></script>
  </head>
  <body>
    <div id="app">

      <!------------------------>
      <!-- ♦ YOUR CODE HERE ♦ -->
      <!------------------------>

      <!-- Example -->
      <script type="text/babel">
        import { message } from 'proof'
        document.getElementById('app').textContent = message
      </script>

    </div>

    <script>
      !function() {

        // Create the IFrame
        var name = "proof",
            id = "proof1",
            src = './proof1.html',
            iframe = document.createElement('iframe');

        iframe.src = src;
        iframe.style="display:none";
        registerMessageListener(id, iframe);
        registerIframeOnload(id, iframe);
        document.body.appendChild(iframe);


        // Register local window listener
        function registerMessageListener(id, iframe) {
          window.addEventListener('message', $)

          function $(_) {
            if (_.data.id === id) {
              console.log('proof: received', '\n', _)
              var script = document.createElement('script');
              script.type="text/babel";
              script.setAttribute('name', name);
              script.textContent = _.data.content;
              document.body.appendChild(script);
              window.removeEventListener('message', $)
              iframe.remove()
            }
          }
        }

        // Register onload for IFrame
        function registerIframeOnload(id, iframe) {
          iframe.onload = onload;

          function onload() {
            var data = {
              id: id,
              eval: '('+$.toString()+')(arguments[0])'
            }
            iframe.contentWindow.postMessage(data, '*')
          }

          function $(_) {
            console.log('proof1: received', '\n', _)
            var a = document.querySelector('script[type="text/babel"]');
            if (a) {
              _.source.postMessage({
                id: _.data.id,
                content: a.textContent
              }, '*')
            }
          }
        }
      }()
    </script>
  </body>
</html>
